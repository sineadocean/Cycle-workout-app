<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Workout Planner</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0b1220">

<style>
:root{
  --bg0:#070b14;
  --bg1:#0b1220;
  --card:#0f172a;
  --card2:#0b1326;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --muted2:#7c8aa6;
  --accent:#2dd4bf;
  --line:rgba(148,163,184,.18);

  --shadow: 0 12px 40px rgba(0,0,0,.45);
  --shadow2: 0 8px 24px rgba(0,0,0,.35);

  --menstrual:#f9a8d4;
  --follicular:#86efac;
  --ovulation:#fde68a;
  --early:#93c5fd;
  --late:#d1d5db;
}

*{box-sizing:border-box;}
html,body{height:100%;}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  background:
    radial-gradient(900px 600px at 20% -10%, rgba(45,212,191,.20), transparent 60%),
    radial-gradient(800px 500px at 95% 10%, rgba(147,197,253,.18), transparent 55%),
    linear-gradient(180deg, var(--bg0), var(--bg1));
  color:var(--text);
}

.wrap{
  max-width: 920px;
  margin: 0 auto;
  padding-bottom: 36px;
}

header{
  position:sticky;
  top:0;
  z-index:10;
  padding: 14px 14px 12px;
  border-bottom: 1px solid var(--line);
  backdrop-filter: blur(10px);
  background: linear-gradient(180deg, rgba(7,11,20,.92), rgba(7,11,20,.70));
}

.hrow{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:12px;
}

h1{
  margin:0;
  font-size: 18px;
  letter-spacing:.2px;
}

#todayInfo{
  margin-top: 8px;
  font-size: 13px;
  color: var(--muted);
  line-height: 1.35;
}

.controls{
  margin-top: 10px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}

input,button{
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: rgba(15,23,42,.85);
  color: var(--text);
  font-size: 14px;
}

input[type="date"]{
  min-width: 220px;
}

button{
  cursor:pointer;
}

button.primary{
  border-color: rgba(45,212,191,.45);
  box-shadow: 0 0 0 4px rgba(45,212,191,.10);
}

button:active{ transform: translateY(1px); }

#calendar{
  padding: 14px;
}

.card{
  margin: 12px 0;
  border-radius: 18px;
  border: 1px solid var(--line);
  background: rgba(15,23,42,.60);
  box-shadow: var(--shadow2);
  overflow:hidden;
}

.bar{ height: 7px; }

.inner{
  padding: 14px 14px 16px;
}

.today{
  border-color: rgba(45,212,191,.55);
  box-shadow: 0 0 0 4px rgba(45,212,191,.12), var(--shadow);
}

.summary{
  list-style:none;
  cursor:pointer;
  user-select:none;
}

.summary::-webkit-details-marker{ display:none; }

.summaryTop{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
}

.title{
  font-weight: 800;
  font-size: 14px;
  letter-spacing:.2px;
  display:flex;
  align-items:center;
  gap:8px;
}

.icon{
  font-size: 15px;
  opacity:.95;
}

.meta{
  margin-top: 4px;
  font-size: 12.5px;
  color: var(--muted);
}

.phaseLine{
  margin-top: 8px;
  font-size: 13px;
  color: var(--text);
  line-height: 1.35;
}

.phaseLine .hint{
  color: var(--muted);
}

.nutrition{
  margin-top: 8px;
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid var(--line);
  background: rgba(11,19,38,.55);
  color: var(--muted);
  font-size: 13px;
}

.kv{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top: 10px;
}

.pill{
  padding: 7px 10px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: rgba(11,19,38,.55);
  font-size: 12.5px;
  color: var(--text);
}

.planBox{
  margin-top: 12px;
  padding: 12px;
  border-radius: 16px;
  border: 1px solid var(--line);
  background: rgba(11,19,38,.55);
}

.sectionTitle{
  font-size: 12px;
  color: var(--muted);
  font-weight: 800;
  letter-spacing:.18em;
  text-transform: uppercase;
  margin: 0 0 8px;
}

.planLine{
  margin: 6px 0;
  line-height: 1.35;
  color: var(--text);
}

.chev{
  color: var(--muted2);
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid var(--line);
  background: rgba(11,19,38,.45);
  white-space:nowrap;
}

.smallNote{
  margin-top: 10px;
  font-size: 12px;
  color: var(--muted2);
}

</style>
</head>

<body>
<div class="wrap">
  <header>
    <div class="hrow">
      <h1>Workout Planner</h1>
    </div>

    <div id="todayInfo">Loadingâ€¦</div>

    <div class="controls">
      <input type="date" id="startDate" />
      <button class="primary" onclick="generate()">Refresh</button>
      <button onclick="resetAll()">Reset</button>
    </div>
  </header>

  <div id="calendar"></div>
</div>

<script>
// Phase config: Stardust-aligned lengths
// Menstrual: 1â€“6
// Follicular: 7â€“9
// Ovulation: 10â€“14
// Early luteal: 15â€“21
// Late luteal: 22â€“28
const phases = [
  {
    name: 'Menstrual',
    icon: 'ðŸŒ¸',
    start: 1, end: 6,
    color: 'var(--menstrual)',
    energy: 'Low outward energy â€¢ restore + reflect',
    nutrition: 'Iron + warmth â€¢ hydration â€¢ gentle nourishment',
    allowed: ['Pilates', 'Yoga'],
    avoid: ['Weights', 'Incline treadmill']
  },
  {
    name: 'Follicular',
    icon: 'ðŸŒ±',
    start: 7, end: 9,
    color: 'var(--follicular)',
    energy: 'Rising energy â€¢ initiation + building',
    nutrition: 'Protein + freshness â€¢ fiber + hydration',
    allowed: ['Weights', 'Incline treadmill'],
    avoid: ['Pilates', 'Yoga'] // per your muscle test
  },
  {
    name: 'Ovulation',
    icon: 'â˜€ï¸',
    start: 10, end: 14,
    color: 'var(--ovulation)',
    energy: 'Peak capacity â€¢ expression + strength',
    nutrition: 'Hydration + electrolytes â€¢ steady meals',
    allowed: ['Weights', 'Incline treadmill', 'Pilates', 'Yoga'],
    avoid: []
  },
  {
    name: 'Early luteal',
    icon: 'ðŸŒ¾',
    start: 15, end: 21,
    color: 'var(--early)',
    energy: 'Steady energy â€¢ sustain + produce',
    nutrition: 'Magnesium support â€¢ grounding meals',
    allowed: ['Weights', 'Incline treadmill', 'Yoga'],
    avoid: ['Pilates']
  },
  {
    name: 'Late luteal',
    icon: 'ðŸŒ™',
    start: 22, end: 28,
    color: 'var(--late)',
    energy: 'Selective energy â€¢ simplify + refine',
    nutrition: 'Magnesium + complex carbs â€¢ extra hydration',
    allowed: ['Pilates', 'Yoga', 'Incline treadmill'],
    avoid: ['Weights']
  }
];

// Weekly set plans
// Tuesday (2): Ballet
// Thursday (4): Home-only (late class)
const weekly = {
  2: 'Ballet',
  4: 'Home-only'
};

const LS_DATE = 'cycleStart_v7';

function isoLocal(d){
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}

function parseDate(v){
  const [y,m,d] = v.split('-').map(Number);
  return new Date(y, m-1, d);
}

function getPhase(cycleDay){
  return phases.find(p => cycleDay >= p.start && cycleDay <= p.end) || phases[0];
}

function weekdayLabel(i){
  return ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][i];
}

function niceDate(d){
  // no weekday, to avoid duplication
  return d.toLocaleDateString(undefined, { month:'short', day:'numeric', year:'numeric' });
}

function computeTodayCycleDay(startDate){
  const today = new Date();
  const startMid = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());
  const todayMid = new Date(today.getFullYear(), today.getMonth(), today.getDate());
  const diffDays = Math.floor((todayMid - startMid) / 86400000);
  return ((diffDays % 28) + 28) % 28 + 1;
}

function generate(){
  const val = document.getElementById('startDate').value;
  if(!val){
    document.getElementById('todayInfo').textContent = 'Set your cycle start date once â€” Iâ€™ll remember it.';
    document.getElementById('calendar').innerHTML = '';
    return;
  }

  localStorage.setItem(LS_DATE, val);

  const start = parseDate(val);
  const today = new Date();
  const todayKey = isoLocal(today);
  const todayCycleDay = computeTodayCycleDay(start);
  const todayPhase = getPhase(todayCycleDay);

  const cal = document.getElementById('calendar');
  cal.innerHTML = '';

  for(let i=0; i<28; i++){
    const d = new Date(start);
    d.setDate(d.getDate() + i);

    const cycleDay = i + 1;
    const phase = getPhase(cycleDay);
    const constraint = weekly[d.getDay()];
    const key = isoLocal(d);

    const isToday = (key === todayKey);
    const isPast = (d < new Date(today.getFullYear(), today.getMonth(), today.getDate()));
    const shouldOpen = isToday || !isPast; // today + future open; past collapsed

    const card = document.createElement('div');
    card.className = 'card' + (isToday ? ' today' : '');

    const bar = document.createElement('div');
    bar.className = 'bar';
    bar.style.background = phase.color;

    const inner = document.createElement('div');
    inner.className = 'inner';

    const details = document.createElement('details');
    if (shouldOpen) details.open = true;

    const summary = document.createElement('summary');
    summary.className = 'summary';

    // Summary header content
    const pillText = shouldOpen ? 'Tap to collapse' : 'Tap to expand';
    summary.innerHTML = `
      <div class="summaryTop">
        <div>
          <div class="title">
            <span class="icon">${phase.icon}</span>
            <span>Day ${cycleDay} â€¢ ${weekdayLabel(d.getDay())} â€¢ ${niceDate(d)}</span>
          </div>
          <div class="meta">${phase.name}${constraint ? ' â€¢ ' + (constraint === 'Ballet' ? 'Ballet day' : 'Home-only') : ''}</div>
        </div>
        <div class="chev">${pillText}</div>
      </div>
    `;

    // Body content
    const body = document.createElement('div');

    const phaseLine = document.createElement('div');
    phaseLine.className = 'phaseLine';
    phaseLine.innerHTML = `<span class="hint">Energy:</span> ${phase.energy}`;

    const nutrition = document.createElement('div');
    nutrition.className = 'nutrition';
    nutrition.innerHTML = `<strong>Nutrition support:</strong> ${phase.nutrition}`;

    body.appendChild(phaseLine);
    body.appendChild(nutrition);

    // Set plan only on Tue/Thu
    if (constraint === 'Ballet'){
      const plan = document.createElement('div');
      plan.className = 'planBox';
      plan.innerHTML = `
        <div class="sectionTitle">Set plan</div>
        <div class="planLine">â€¢ Ballet class</div>
        <div class="smallNote">Everything else is optional â€” keep it light if you want.</div>
      `;
      body.appendChild(plan);
    } else if (constraint === 'Home-only'){
      const plan = document.createElement('div');
      plan.className = 'planBox';
      plan.innerHTML = `
        <div class="sectionTitle">Set plan</div>
        <div class="planLine">â€¢ Pilates or Yoga (at home)</div>
        <div class="smallNote">Short counts. Gentle counts. Done is done.</div>
      `;
      body.appendChild(plan);
    } else {
      const kv = document.createElement('div');
      kv.className = 'kv';
      kv.innerHTML = `
        <span class="pill">Allowed: ${phase.allowed.join(', ')}</span>
        <span class="pill">Avoid: ${phase.avoid.length ? phase.avoid.join(', ') : 'â€”'}</span>
      `;
      body.appendChild(kv);
    }

    details.appendChild(summary);
    details.appendChild(body);

    inner.appendChild(details);
    card.appendChild(bar);
    card.appendChild(inner);
    cal.appendChild(card);
  }

  document.getElementById('todayInfo').textContent =
    `Today â€¢ ${niceDate(today)} â€¢ Cycle Day ${todayCycleDay} (${todayPhase.icon} ${todayPhase.name})`;

  // Scroll to today
  const t = document.querySelector('.card.today');
  if(t) setTimeout(() => t.scrollIntoView({behavior:'smooth', block:'start'}), 80);
}

function resetAll(){
  localStorage.removeItem(LS_DATE);
  location.reload();
}

window.onload = ()=>{
  const saved = localStorage.getItem(LS_DATE);
  if(saved){
    document.getElementById('startDate').value = saved;
    generate();
  } else {
    document.getElementById('todayInfo').textContent = 'Set your cycle start date once â€” Iâ€™ll remember it.';
  }
};
</script>
</body>
</html>
