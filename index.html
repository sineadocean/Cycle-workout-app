<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cycle Tracker</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0f172a">

<style>
:root{
  --bg:#0f172a;
  --card:#111827;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --accent:#2dd4bf;
  --line:#1f2937;

  --menstrual:#f9a8d4;
  --follicular:#86efac;
  --ovulation:#fde68a;
  --early:#93c5fd;
  --late:#d1d5db;
}

body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto;
  background:var(--bg);
  color:var(--text);
}

header{
  position:sticky;
  top:0;
  background:#0f172aee;
  backdrop-filter:blur(8px);
  padding:14px;
  border-bottom:1px solid var(--line);
}

h1{margin:0;font-size:20px;}

.controls{
  margin-top:8px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

input,button{
  padding:10px;
  border-radius:10px;
  border:1px solid var(--line);
  background:var(--card);
  color:var(--text);
  font-size:14px;
}

button.primary{
  border-color:var(--accent);
}

#todayInfo{
  margin-top:6px;
  font-size:13px;
  color:var(--muted);
}

.card{
  margin:12px;
  border-radius:16px;
  background:var(--card);
  border:1px solid var(--line);
  overflow:hidden;
}

.bar{height:6px;}

.inner{padding:14px;}

.today{
  box-shadow:0 0 0 3px #2dd4bf33;
}

label{
  display:flex;
  gap:8px;
  align-items:center;
  margin:6px 0;
}

textarea{
  width:100%;
  border-radius:10px;
  padding:10px;
  background:#020617;
  border:1px solid var(--line);
  color:var(--text);
  margin-top:8px;
}

small{color:var(--muted);}
</style>
</head>

<body>

<header>
  <h1>Cycle Tracker</h1>
  <div id="todayInfo"></div>

  <div class="controls">
    <input type="date" id="startDate">
    <button class="primary" onclick="generate()">Refresh</button>
    <button onclick="resetAll()">Reset</button>
  </div>
</header>

<div id="calendar"></div>

<script>
const phases=[
 {name:'Menstrual',start:1,end:6,color:'var(--menstrual)',workouts:['Pilates','Walk']},
 {name:'Follicular',start:7,end:9,color:'var(--follicular)',workouts:['Weights','Incline Walking']},
 {name:'Ovulation',start:10,end:14,color:'var(--ovulation)',workouts:['Weights','Incline Walking','Pilates']},
 {name:'Early Luteal',start:15,end:21,color:'var(--early)',workouts:['Weights','Incline Walking']},
 {name:'Late Luteal',start:22,end:28,color:'var(--late)',workouts:['Pilates','Incline Walking']}
];

const weekly={
1:'Gym',2:'Ballet',3:'Walk',4:'Home',5:'Flex',6:'Flex',0:'Flex'
};

const LS_DATE='cycleStart';
const LS_STATE='cycleState';

function iso(d){return d.toISOString().split('T')[0];}

function getPhase(day){
 return phases.find(p=>day>=p.start&&day<=p.end);
}

function workoutsFor(phase,weekday){
 if(weekly[weekday]==='Ballet') return ['Ballet'];
 if(weekly[weekday]==='Walk') return ['Walk'];
 if(weekly[weekday]==='Home'){
  let arr=[];
  if(phase.workouts.includes('Pilates')) arr.push('Pilates');
  arr.push('Walk');
  return arr;
 }
 let arr=[...phase.workouts];
 if(!arr.includes('Walk')) arr.push('Walk');
 return arr;
}

function loadState(){return JSON.parse(localStorage.getItem(LS_STATE)||'{}');}
function saveState(s){localStorage.setItem(LS_STATE,JSON.stringify(s));}

function generate(){
 const val=document.getElementById('startDate').value;
 if(!val) return;
 localStorage.setItem(LS_DATE,val);

 const [y,m,d]=val.split('-').map(Number);
 const start=new Date(y,m-1,d);
 const today=new Date();
 const todayISO=iso(today);

 const state=loadState();
 const cal=document.getElementById('calendar');
 cal.innerHTML='';

 let todayDay=null,todayPhase=null;

 for(let i=0;i<28;i++){
  const date=new Date(start);
  date.setDate(date.getDate()+i);
  const cycleDay=i+1;
  const phase=getPhase(cycleDay);
  const dayISO=iso(date);

  if(dayISO===todayISO){
   todayDay=cycleDay;
   todayPhase=phase.name;
  }

  const card=document.createElement('div');
  card.className='card';
  if(dayISO===todayISO) card.classList.add('today');

  const bar=document.createElement('div');
  bar.className='bar';
  bar.style.background=phase.color;
  card.appendChild(bar);

  const inner=document.createElement('div');
  inner.className='inner';

  inner.innerHTML=`<strong>Day ${cycleDay} — ${date.toDateString()}</strong><br>
  <small>${phase.name}</small>`;

  const workouts=workoutsFor(phase,date.getDay());

  workouts.forEach(w=>{
   const id=dayISO+'_'+w;
   const row=document.createElement('label');
   row.innerHTML=`<input type="checkbox" ${state[id]?'checked':''}> ${w}`;
   row.querySelector('input').onchange=e=>{
    state[id]=e.target.checked;
    saveState(state);
   };
   inner.appendChild(row);
  });

  const note=document.createElement('textarea');
  note.placeholder='Notes…';
  note.value=state[dayISO+'_note']||'';
  note.oninput=e=>{
   state[dayISO+'_note']=e.target.value;
   saveState(state);
  };
  inner.appendChild(note);

  card.appendChild(inner);
  cal.appendChild(card);
 }

 const info=document.getElementById('todayInfo');
 info.textContent=todayDay
  ?`Today — Cycle Day ${todayDay} (${todayPhase})`
  :'Set cycle start date';
}

function resetAll(){
 localStorage.removeItem(LS_DATE);
 localStorage.removeItem(LS_STATE);
 location.reload();
}

window.onload=()=>{
 const saved=localStorage.getItem(LS_DATE);
 if(saved){
  document.getElementById('startDate').value=saved;
  generate();
 }
};
</script>

</body>
</html>
